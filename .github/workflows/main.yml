name: CI-CD

on:
 push:
  branches: ["main"]
 workflow_dispatch:
jobs:
 ci:
  runs-on: ubuntu-latest
  steps:
   - name: Obter o c√≥digo do porjeto
     uses: actions/checkout@v4
   - name: Login to Docker Hub
     uses: docker/login-action@v3
     with:
      username: ${{ secrets.DOCKERHUB_USERNAME }}
      password: ${{ secrets.DOCKERHUB_TOKEN }}
   - name: Build and push
     uses: docker/build-push-action@v6
     with:
      context: ./src
      file: ./stc/Dockerfile
      push: true
      tags: |
        rafaj2ee/fake-shop:latest
        rafaj2ee/fake-shop:v${{ github.run_number }}
   - name: Envio de imagem Docker
     run: echo "Executando comando Docker Push"
 cd:
  runs-on: ubuntu-latest
  needs: [ci]
  steps:
   - name: Autenticar na AWS
     run: echo "Executando comando aws configure"
   - name: Configurar o kubctl
     run: echo "Executando o comando aws eks update-kubeconfig"
   - name: Deploy dos manifestos no kubernetes
     run: echo "Executando comando kubectl apply"
